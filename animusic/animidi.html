<html>
<head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.8.0/p5.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.8.0/addons/p5.dom.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.8.0/addons/p5.sound.min.js"></script>
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
</head>
<body>
<script>

print = console.log;

var PITCH_NAME = "A",
    PITCH_NUM  = 4,
    PITCH_FREQ = 440;
var BEAT = 4,
    NOTE_VALUE = 4;
var TIME_SIG = BEAT/NOTE_VALUE;
var BPM = 120;
// For any note value: dura_tmp = dura * beat/mva
var DURA = 60/BPM;
// C Major: C C# D D# E F F# G G# A A# B
var PITCH_NAMES   = ["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];
// var PITCH_NAMES_B = ["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];

// MidiToTabConverter
//   https://tabnabber.com/MidiToTabConverter.aspx

// Fur Elise by Beethoven - Piano Letter Notes
//   https://pianoletternotes.blogspot.com/2015/11/fur-elise-by-beethoven.html
// Sky High by Elektronomia
//   https://pianoletternotes.blogspot.com/2019/06/sky-high-by-elektronomia.html
// Can Can by Offenbach
//   https://pianoletternotes.blogspot.com/2017/10/can-can-by-offenbach.html

var oscs = [];
// var notes = [[440,0,1],[300,1,1],[700,2,1]];
// var song = "C C G G A A G \
//             F F E E D D C \
//             G G F F E E D \
//             G G F F E E D \
//             C C G G A A G \
//             F F E E D D C";
// song = "C3 C#3 D3 D#3 E3 F3 F#3 G3 G#3 A3 A#3 B3\
//         C4 C#4 D4 D#4 E4 F4 F#4 G4 G#4 A4 A#4 B4\
//         C5 C#5 D5 D#5 E5 F5 F#5 G5 G#5 A5 A#5 B5\
//         C6 C#6 D6 D#6 E6 F6 F#6 G6 G#6 A6 A#6 B6";
var song = [];

var notes = song.split(/\s+/);
print(notes);

function 

// // Note: pitch (X) - note value(1/N) - repeat
// // C#4-4-2
// // C# == C#4-4-1
// function parseNote(note) {
//     var info = note.match(/([CDEFGAB]#?)?(\d+)?(?:-(\d+)?)?(?:-(\d+)?)?/i);
//     // "C#4-8-1": ["C#4-8-1", "C#", "4", "8", "1"]
//     var pitch_name  = (info[1] || PITCH_NAME);
//     var pitch_num   = (info[2] || PITCH_NUM);
//     var note_value  = (info[3] || NOTE_VALUE);
//     var repeat      = (info[4] || 1);
//     var parsed_note = [pitch_name, pitch_num, note_value, repeat];
//     // print(parsed_note);
//     return parsed_note;
// }

// Piano key frequencies
//   https://en.wikipedia.org/wiki/Piano_key_frequencies
// Frequencies for equal-tempered scale, A4 = 440 Hz
//   http://pages.mtu.edu/~suits/notefreqs.html
function pitch2freq(pitch_name, pitch_num) {
    var base_index = PITCH_NAMES.indexOf(PITCH_NAME);
    var pitch_index = PITCH_NAMES.indexOf(pitch_name);
    var index_diff = (pitch_index - base_index) + (pitch_num - PITCH_NUM) * 12;
    var pitch_freq = PITCH_FREQ * Math.pow(2, index_diff/12)
    // print(pitch_name,pitch_num,index_diff,pitch_freq);
    return pitch_freq;
}

var note, parsed_note, pitch_freq;
var parsed_notes = [],
    pitch_freqs  = [];
for (var i=0; i<notes.length; ++i) {
    note = notes[i];
    parsed_note = parseNote(note);
    pitch_freq = pitch2freq(parsed_note[0], parsed_note[1]);
    pitch_freqs.push(pitch_freq);
    // print(note,pitch_freq);
}

var cnt = 0;
var step = 0.5;
var dura;
function setup(){
    for (let i=0;i<notes.length;++i) {
        note = notes[i];
        parsed_note = parseNote(note);

        oscs.push(new p5.TriOsc());
        osc = oscs[oscs.length-1];
        dura = 0.5*NOTE_VALUE/int(parsed_note[2]);
        osc.freq(pitch_freqs[i]);
        osc.start(cnt);
        osc.amp(1);
        osc.stop(cnt+dura);
        cnt+=dura;
    }
}

function draw(){

}

</script>
</body>
</html>